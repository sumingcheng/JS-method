<script>
  <!--构造函数核心、构造器和参数-->
  function myNew(constructor, ...args) {
    // 创建一个新对象，将其原型设置为构造函数的原型

    const obj = Object.create(constructor.prototype)

    const result = constructor.apply(obj, args)
    console.log(result)
    // 如果构造函数返回一个对象，那么直接返回该对象
    if (typeof result === 'object' && result !== null) {
      return result
    }

    return obj
  }

  function Person(name, age) {
    this.name = name
    this.age = age
  }

  Person.prototype.method = function () {
    console.log(this.name)
  }

  const john = myNew(Person, 'John', 30)
  john.method()

</script>
<script>
  // es6
  function myNew(constructor, ...args) {
    // 1. 创建一个空对象
    const obj = {}

    // 2. 将对象的原型链指向构造函数的原型对象
    Object.setPrototypeOf(obj, constructor.prototype)

    // 3. 将对象作为构造函数的上下文
    const result = constructor.apply(obj, args)

    // 4. 如果构造函数返回一个对象，则返回该对象，否则返回上面创建的对象
    return result instanceof Object ? result : obj
  }

</script>
